<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Low-level scattermore API • scattermore</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Low-level scattermore API">
<meta property="og:description" content="scattermore">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scattermore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/low_level_interface.html">Low-level scattermore API</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Low-level scattermore API</h1>
            
      
      
      <div class="hidden name"><code>low_level_interface.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scattermore</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>bitmapType<span class="op">=</span><span class="st">'cairo'</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="low-level-interface-of-scattermore">Low-level interface of Scattermore<a class="anchor" aria-label="anchor" href="#low-level-interface-of-scattermore"></a>
</h2>
<p>This vignette gives an overview and comprehensive examples of using
the low-level API of <code>scattermore</code>. Using the API you can do
many more things than just plotting points; mainly
<code>scattermore</code> supports plotting both 2D-histograms (density
plots) and image rasters from both points and lines (and possibly other
shapes in the future), modifying and expanding both histograms and image
rasters with kernels, and blending all of these using
ordering-independent blending methods.</p>
<p>The low-level API operates mostly on plain R matrices or arrays;
these are formatted in:</p>
<ul>
<li>integer and floating-point histograms/densities</li>
<li>RGBWT-formatted rasters</li>
<li>floating-point RGBA-formatted rasters with colors “premultiplied” by
alpha channel for easier blending</li>
<li>integer RGBA-formatted rasters (without premultiplication)</li>
</ul>
<p>One typically starts with either generating the densities or RGBWT
rasters, and successively moves lower in the list towards the usual
integer RGBA, which may be e.g. converted to a normal R raster.</p>
<p>RGBWT format is specific to <code>scattermore</code>, standing for
Red Green Blue Weight Transparency. It is similar to a floating-point
RGBA with premultiplied alpha: channels R, G, B behave just like in
RGBA, channel T is equivalent to (1-A), and channel W (initially
equivalent to A) collect the total amount of “paint” that the given
pixel has accumulated. With this, blending of layers is guaranteed to be
order independent: values in channels RGBW are added together, and
values in T are multiplied. To convert RGBWT back to RGBA, one computes
A=(1-T), and divides the channels R,G,B by the value of W.</p>
<div class="section level3">
<h3 id="plotting-data-as-densities">Plotting data as densities<a class="anchor" aria-label="anchor" href="#plotting-data-as-densities"></a>
</h3>
<p>Let us first generate a small random dataset of points and
directions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>, <span class="va">n</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pts2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="op">-</span><span class="fl">5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can convert the density data to an integer density map:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdens</span> <span class="op">&lt;-</span> <span class="fu">scattermore</span><span class="fu">::</span><span class="fu"><a href="../reference/scatter_points_histogram.html">scatter_points_histogram</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>,<span class="fl">128</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">pdens</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-2-1.png" width="480"></p>
<p>The same can be done for plotting the densities over the lines:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ldens</span> <span class="op">&lt;-</span> <span class="fu">scattermore</span><span class="fu">::</span><span class="fu"><a href="../reference/scatter_lines_histogram.html">scatter_lines_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">256</span>,<span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">ldens</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<p>Densities are simple matrices, so in order to improve the
visualization you can apply the usual R math functions to their
contents:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ldens</span> <span class="op">&lt;-</span> <span class="fu">scattermore</span><span class="fu">::</span><span class="fu"><a href="../reference/scatter_lines_histogram.html">scatter_lines_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">256</span>,<span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">ldens</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="plotting-data-as-colored-pixels">Plotting data as colored pixels<a class="anchor" aria-label="anchor" href="#plotting-data-as-colored-pixels"></a>
</h3>
<p>Colored stuff is usually plotted to a 5-channel RGBWT raster format,
which eliminates the typical overplotting artifacts. This is later
converted to either RGBA or a standard R rasters for plotting.</p>
<p>We can plot the points with a single color to the RGBWT format using
<code>scatter_points_rgbwt</code>. We also show how to fix the precise
displayed area using <code>xlim</code> and <code>ylim</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO xlim docs</span></span>
<span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>You can specify a single color (possibly with alpha channel) for
plotting; here we force a lower resolution and turn off pixel
interpolation to show the transparency effect more precisely:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>,<span class="fl">128</span><span class="op">)</span>, RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="st">'#8010f010'</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span>, interpolate<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<p>The <code>RGBA</code> parameter may also assign individual colors to
each pixel:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>,<span class="fl">128</span><span class="op">)</span>, RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="va">n</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span>, interpolate<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<p>For plotting large clusters that share the colors, arguments
<code>map</code> and <code>palette</code> allow for simpler and more
efficient specification of the plotting:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">pts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">pts</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>,<span class="fl">128</span><span class="op">)</span>, palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, map<span class="op">=</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span>, interpolate<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<p>Colored RGBWT lines are plotted similarly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#TODO as.vector</span></span>
<span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_lines_rgbwt.html">scatter_lines_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>,</span>
<span>    xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="st">'#8010f005'</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="expanding-densities-and-rgbwt-plots">Expanding densities and RGBWT plots<a class="anchor" aria-label="anchor" href="#expanding-densities-and-rgbwt-plots"></a>
</h3>
<p>Scattermore takes a distinctive approach to plotting points that are
larger than a single pixel – these are not plotted immediately as large,
but instead start as single-pixel “centers” and are later expanded using
a kernel function. The expansion is faster for plots that contain huge
values of individual points, because the “expansion” operations is
aggregated for multiple pixels, and the operation is much more
computationally regular, giving additional speedups.</p>
<p>First, let’s increase the resolution of the example from above:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>, palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, map<span class="op">=</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>This is sub-optimal because the pixels are too small; to fix that we
can expand them:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>, palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span>, alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, map<span class="op">=</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_rgbwt.html">apply_kernel_rgbwt</a></span><span class="op">(</span><span class="va">rgbwt</span>, <span class="st">'circle'</span>, radius<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>There are also other expansion options (such as <code>gauss</code>
and <code>square</code>). You can also supply your own kernel in order
to plot different shapes of pixels:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>, palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span>, alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, map<span class="op">=</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_rgbwt.html">apply_kernel_rgbwt</a></span><span class="op">(</span><span class="va">rgbwt</span>, <span class="st">'own'</span>,</span>
<span>    mask<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">11</span>, <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>The same can be applied to line data to get thicker lines (we limit
the number of lines for simplicity here):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_lines_rgbwt.html">scatter_lines_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,<span class="op">]</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>,</span>
<span>    xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="st">'#8010f010'</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_rgbwt.html">apply_kernel_rgbwt</a></span><span class="op">(</span><span class="va">rgbwt</span>, <span class="st">'circle'</span>, radius<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<p>Gaussian kernels are excellent for smoothing out point and line
densities. As the main change, we need to use the histogram-specific
kernel function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdens</span> <span class="op">&lt;-</span> <span class="fu">scattermore</span><span class="fu">::</span><span class="fu"><a href="../reference/scatter_points_histogram.html">scatter_points_histogram</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">256</span>,<span class="fl">256</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pdens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_histogram.html">apply_kernel_histogram</a></span><span class="op">(</span><span class="va">pdens</span>, <span class="st">'gauss'</span>, radius<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">pdens</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
<p>The calculated densities can be trivially used for overlaying the
images with contours. (N. B. that the default gaussian kernels are not
“balanced” and increase the total weight present in the graphics; you
may still supply a unit weight kernel using the <code>own</code>
parameter.)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">pdens</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">topo.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="fl">20</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">pdens</span><span class="op">-</span><span class="fl">15</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">0</span>,<span class="fl">30</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="coloring-densities">Coloring densities<a class="anchor" aria-label="anchor" href="#coloring-densities"></a>
</h3>
<p>Specific functionality is provided for converting densities to
colorized “heat” maps, converting the histogram to RGBWT format. This is
useful for later blending with other RGBWT data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdens</span> <span class="op">&lt;-</span> <span class="fu">scattermore</span><span class="fu">::</span><span class="fu"><a href="../reference/scatter_points_histogram.html">scatter_points_histogram</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pdens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_histogram.html">apply_kernel_histogram</a></span><span class="op">(</span><span class="va">pdens</span>, <span class="st">'circle'</span>, radius<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/histogram_to_rgbwt.html">histogram_to_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">pdens</span><span class="op">)</span>, RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">topo.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="merging-rgbwt-and-rgba-layers">Merging RGBWT and RGBA layers<a class="anchor" aria-label="anchor" href="#merging-rgbwt-and-rgba-layers"></a>
</h3>
<p>Functions for blending (“merging”) the RGBWT and RGBA layers are
available with one substantial difference: - Merging RGBWT layers never
causes overplotting. The layers are merged to produce a weighted mean,
with neither being “on top”. - Merging RGBA layers explicitly covers one
layer by the other one, depending on the alpha value.</p>
<p>To showcase this functionality, we show the difference between truly
merging and overlaying our data. First, it is necessary to manually
ensure that the data is plotted at the same bitmap size with the same
coordinates:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_lines_rgbwt.html">scatter_lines_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>,</span>
<span>    xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="st">'#ffcc0010'</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rgbwt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>, out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>,</span>
<span>    xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, map<span class="op">=</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">rgbwt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_rgbwt.html">apply_kernel_rgbwt</a></span><span class="op">(</span><span class="va">rgbwt2</span>, <span class="st">'circle'</span>, radius<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>We now merge the data as RGBWT, without overplotting either layer.
Notably, the <code>merge_rgbwt</code> operation is associative and
commutative (except for small numerical imperfections).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_rgbwt.html">merge_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">rgbwt1</span>, <span class="va">rgbwt2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_int.html">rgbwt_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>In this case, neither the lines and points is “in foreground”, the
colors are correctly merged according to the total amount of “ink”
applied to each point in the canvas.</p>
<p>If blending in RGBA format, the colors will overlay depending on the
order. First with lines on top:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgbwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blend_rgba_float.html">blend_rgba_float</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_float.html">rgbwt_to_rgba_float</a></span><span class="op">(</span><span class="va">rgbwt1</span><span class="op">)</span>, <span class="fu"><a href="../reference/rgbwt_to_rgba_float.html">rgbwt_to_rgba_float</a></span><span class="op">(</span><span class="va">rgbwt2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgba_float_to_rgba_int.html">rgba_float_to_rgba_int</a></span><span class="op">(</span><span class="va">rgbwt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
<p>…and with points on top:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgba</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blend_rgba_float.html">blend_rgba_float</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgbwt_to_rgba_float.html">rgbwt_to_rgba_float</a></span><span class="op">(</span><span class="va">rgbwt2</span><span class="op">)</span>, <span class="fu"><a href="../reference/rgbwt_to_rgba_float.html">rgbwt_to_rgba_float</a></span><span class="op">(</span><span class="va">rgbwt1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgba_float_to_rgba_int.html">rgba_float_to_rgba_int</a></span><span class="op">(</span><span class="va">rgba</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<p>For demonstration, we produce a huge, colorful, truly psychidelic
graphics that combines all of the elements:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lines</span></span>
<span><span class="va">rgbwt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_lines_rgbwt.html">scatter_lines_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>    out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="st">'#fff0c018'</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># points</span></span>
<span><span class="va">rgbwt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_rgbwt.html">scatter_points_rgbwt</a></span><span class="op">(</span><span class="va">pts</span>,</span>
<span>    out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, map<span class="op">=</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">rgbwt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_rgbwt.html">apply_kernel_rgbwt</a></span><span class="op">(</span><span class="va">rgbwt2</span>, <span class="st">'circle'</span>, radius<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># background density of the line endpoints</span></span>
<span><span class="va">pdens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scatter_points_histogram.html">scatter_points_histogram</a></span><span class="op">(</span><span class="va">pts2</span>,</span>
<span>    out_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>,<span class="fl">512</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pdens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_kernel_histogram.html">apply_kernel_histogram</a></span><span class="op">(</span><span class="va">pdens</span>, <span class="st">'gauss'</span>, radius<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">rgbwt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/histogram_to_rgbwt.html">histogram_to_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">pdens</span><span class="op">)</span>, RGBA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/col2rgb.html" class="external-link">col2rgb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">topo.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="fl">20</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>, alpha<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rgba</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blend_rgba_float.html">blend_rgba_float</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/rgbwt_to_rgba_float.html">rgbwt_to_rgba_float</a></span><span class="op">(</span><span class="fu"><a href="../reference/merge_rgbwt.html">merge_rgbwt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">rgbwt1</span>, <span class="va">rgbwt2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/rgbwt_to_rgba_float.html">rgbwt_to_rgba_float</a></span><span class="op">(</span><span class="va">rgbwt3</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rgba_int_to_raster.html">rgba_int_to_raster</a></span><span class="op">(</span><span class="fu"><a href="../reference/rgba_float_to_rgba_int.html">rgba_float_to_rgba_int</a></span><span class="op">(</span><span class="va">rgba</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">rstr</span><span class="op">)</span>, xleft<span class="op">=</span><span class="op">-</span><span class="fl">3</span>, xright<span class="op">=</span><span class="fl">7</span>, ybottom<span class="op">=</span><span class="op">-</span><span class="fl">5</span>, ytop<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># a trick is required to flip the bitmap vertically</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">7</span>,length.out<span class="op">=</span><span class="fl">512</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">2</span>,length.out<span class="op">=</span><span class="fl">512</span><span class="op">)</span>, <span class="va">pdens</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">pdens</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span>, add<span class="op">=</span><span class="cn">T</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="low_level_interface_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="exporting-high-quality-graphics">Exporting high-quality graphics<a class="anchor" aria-label="anchor" href="#exporting-high-quality-graphics"></a>
</h3>
<p>Running the graphics through the R plotting pipeline may result in
losing pixel-perfect details by interpolating to a slightly imprecise
raster. One may save RGBA format to PNG graphics directly, which gives
pixel-perfect output together with some other properties (such as
preserved transparency).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">png</span><span class="fu">::</span><span class="fu">writePNG</span><span class="op">(</span><span class="fu"><a href="../reference/rgba_float_to_rgba_int.html">rgba_float_to_rgba_int</a></span><span class="op">(</span><span class="va">rgba</span><span class="op">)</span><span class="op">/</span><span class="fl">255</span>, <span class="st">"myPicture.png"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tereza Kulichova, Mirek Kratochvil.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
