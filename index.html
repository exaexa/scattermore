<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scatterplots with More Points • scattermore</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Scatterplots with More Points">
<meta property="og:description" content="C-based conversion of large scatterplot data to rasters plus other 
             operations such as data blurring or data alpha blending. Speeds up 
             plotting of data with millions of points.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">scattermore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/histogram_lines.html">Scatter histogram with lines</a>
    </li>
    <li>
      <a href="articles/histogram_points.html">Scatter histogram with points</a>
    </li>
    <li>
      <a href="articles/merge_and_blend.html">Merge and blend</a>
    </li>
    <li>
      <a href="articles/rgbwt_lines.html">Scatter rgbwt with lines</a>
    </li>
    <li>
      <a href="articles/rgbwt_points.html">Scatter rgbwt with points</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="scattermore">scattermore<a class="anchor" aria-label="anchor" href="#scattermore"></a>
</h1></div>

<p>Scatterplots with more datapoints. If you want to plot bazillions of points without much waiting, use this.</p>
<p>If you want to report the usage of scattermore within a scientific project, you may want to refer to it systematically – scattermore has been peer-reviewed as a part of a larger package for interactive cytometry data analysis (<a href="https://gitlab.com/exaexa/ShinySOM" class="external-link">ShinySOM</a>). Links here: <a href="https://pubmed.ncbi.nlm.nih.gov/32049322/" class="external-link">PubMed 32049322</a>, <a href="https://academic.oup.com/bioinformatics/article/36/10/3288/5734646?login=true" class="external-link">OUP</a>, <a href="https://doi.org/10.1093/bioinformatics/btaa091" class="external-link">doi:10.1093/bioinformatics/btaa091</a></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<ul>
<li>from CRAN repositories (recommended): <code>install.packages('scattermore')</code>
</li>
<li>from GitHub (development version: <code>devtools::install_github('exaexa/scattermore')</code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="quick-how-to">Quick How-To<a class="anchor" aria-label="anchor" href="#quick-how-to"></a>
</h2>
<p>Function <code>scattermoreplot</code> is meant to behave roughly like the standard <code>plot</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scattermore</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/scattermoreplot.html">scattermoreplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1e7</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1e7</span><span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span><span class="op">(</span><span class="fl">1e7</span>, alpha<span class="op">=</span><span class="fl">.1</span><span class="op">)</span>,</span>
<span>        main<span class="op">=</span><span class="st">'Scattermore demo'</span><span class="op">)</span></span></code></pre></div>
<p>If you use <code>ggplot2</code>, you can use <code>geom_scattermore</code> instead of <code>geom_point</code> to rasterize the graphics (e.g. to reduce PDF size):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">....</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/geom_scattermore.html">geom_scattermore</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>(Note that the processing of data in ggplot is usually too slow itself; use <code>geom_scattermost</code> to dodge that.)</p>
</div>
<div class="section level2">
<h2 id="advanced-usage">Advanced usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h2>
<p>Function <code>scattermore</code> only creates the raster graphics for the plots; this can be plotted out afterwards (or processed in any other weird ways). Let’s try a manual benchmark:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># create 10 million 2D datapoints</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>data &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(<span class="fl">1e7</span>),<span class="kw">rnorm</span>(<span class="fl">1e7</span>))</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># prepare empty plot</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># plot the datapoints and see how long it takes</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw">system.time</span>(<span class="kw">plot</span>(<span class="kw">scattermore</span>(data, <span class="dt">rgba=</span><span class="kw">c</span>(<span class="dv">64</span>,<span class="dv">128</span>,<span class="dv">192</span>,<span class="dv">10</span>), <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>))))</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a>   user  system elapsed</span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="fl">0.413</span>   <span class="fl">0.044</span>   <span class="fl">0.461</span></span></code></pre></div>
<p>You should immediately see <em>quite a heap</em> of tiny points:</p>
<div class="figure">
<img src="media/result.png" title="Scatterplot" alt=""><p class="caption">Resulting scatterplot</p>
</div>
<p>Now, how fast would the standard <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> do?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># compare with the usual plot function on x11/cairo</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">system.time</span>(<span class="kw">plot</span>(data, <span class="dt">pch=</span><span class="st">'.'</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="dt">col=</span><span class="kw">rgb</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.04</span>)))</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>   user  system elapsed</span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fl">9.752</span>   <span class="fl">0.023</span>   <span class="fl">9.794</span></span></code></pre></div>
<p>This way, 0.46 seconds of <code>scattermore</code> means a nice ~20x speedup over <code>plot</code> on my laptop. Moreover, if you use different plotting setups (basically any non-Cairo, say windows- or quartz-based <code>grDevices</code> backends), you will very possibly see much greater speedups. Cairo itself is sometimes more than 10x faster than the other backends. That means scattermore may be over 200x faster in total.</p>
</div>
<div class="section level2">
<h2 id="how-does-it-work">How does it work?<a class="anchor" aria-label="anchor" href="#how-does-it-work"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Points and colors get converted to vectors and passed to C</li>
<li>C code rasterizes the whole thing to a prepared bitmap. This is already quite fast, but some low-level optimization can probably speed it up several more times. Volunteers/pull requests welcome. (Is there a way to push a raw <code>uint8_t</code> array into C from R?)</li>
<li>The resulting array gets converted to R raster using <code>as.raster</code>, which can get plotted. (Fun fact: When plotting less than roughly 1 million points, most computational time is spent only by this conversion!)</li>
</ol>
</div>
<div class="section level2">
<h2 id="how-fast-is-it">How fast is it?<a class="anchor" aria-label="anchor" href="#how-fast-is-it"></a>
</h2>
<p>Let us measure the same example as above, with points limited to different sizes (i.e. in the first case, scattermore receives <code>data[1:1e4,]</code>):</p>
<pre><code>points  .  average time (s)
--------+------------------
1e4     .  0.037
3e4     .  0.039
1e5     .  0.042
3e5     .  0.051
1e6     .  0.076     -- ~50% of the time is R raster conversion overhead
3e6     .  0.170     -- caches start to overflow here
1e7     .  0.460</code></pre>
<p>(Multicolor plotting is slightly slower (usually 2x), because the reading and transporting of the relatively large color matrix eats quite a lot of cache.)</p>
</div>
<div class="section level2">
<h2 id="how-nice-is-it">How nice is it?<a class="anchor" aria-label="anchor" href="#how-nice-is-it"></a>
</h2>
<p>Custom rasterization gives a bit of extra features. These are the two most obvious:</p>
<ol style="list-style-type: decimal">
<li>The gazillions of points are present as a raster, even in vector output. That might be a problem sometimes (remember to use sufficient raster size to get the desired DPI!), but makes vector output smaller and much more easily processed by other tools. (Remember the huge PDFs with scatterplots that take a minute to load?)</li>
<li>The rasterization is not required to work in limited memory as in usual plotting libraries, which we use to gain a bit of extra precision in color mixing. This is most visible when plotting a ton of low-alpha points where the usual blending methods produce ugly rounding artifacts.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scattermore</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># data</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1e6</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1e6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># first plot (geom_point)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">'point.png'</span>, units<span class="op">=</span><span class="st">'in'</span>, width<span class="op">=</span><span class="fl">3</span>, height<span class="op">=</span><span class="fl">3</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">d</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,y<span class="op">=</span><span class="va">d</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape<span class="op">=</span><span class="st">'.'</span>, alpha<span class="op">=</span><span class="fl">.05</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,color<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>guide<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"geom_point"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># second plot (geom_scattermost)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">'scattermore.png'</span>, units<span class="op">=</span><span class="st">'in'</span>, width<span class="op">=</span><span class="fl">3</span>, height<span class="op">=</span><span class="fl">3</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="reference/geom_scattermost.html">geom_scattermost</a></span><span class="op">(</span></span>
<span>    <span class="va">d</span>,</span>
<span>    col<span class="op">=</span><span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span>, alpha<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">+</span><span class="fl">99</span><span class="op">*</span><span class="va">d</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    pointsize<span class="op">=</span><span class="fl">2</span>,</span>
<span>    pixels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">700</span>,<span class="fl">700</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"geom_scattermost"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img alt="Plot with geom_point" src="/media/point.png" width="50%"><img alt="Plot with geom_scattermore" src="/media/scattermore.png" width="50%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=scattermore" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing scattermore</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Tereza Kulichova <br><small class="roles"> Author </small>  </li>
<li>Mirek Kratochvil <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-7356-4075" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=scattermore" class="external-link"><img src="https://www.r-pkg.org/badges/version/scattermore" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=scattermore" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/scattermore" alt="CRAN downloads"></a></li>
<li><a href="https://codecov.io/gh/exaexa/scattermore" class="external-link"><img src="https://codecov.io/gh/exaexa/scattermore/branch/master/graph/badge.svg?token=L1YIYBSLTW" alt="codecov"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Tereza Kulichova, Mirek Kratochvil.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
